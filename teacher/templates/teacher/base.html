 {% load static %}
 {% load i18n %}
 
<!DOCTYPE html>
{% if lang == "ar/" %}
<html lang="en" dir="rtl">
{% else %}
<html lang="en" dir="ltr">
{% endif %}

<style>
#loadings {
   width: 100%;
   height: 100%;
   top: 0;
   left: 0;
   position: fixed;
   display: block;
   opacity: 0.9;
   background-color: #000;
   
   
   z-index: 99;
   text-align: center;
}

#loading-image {
  position: absolute;
  top: 27%;
  left: 40%;
  z-index: 100;
}


</style>




<style>
    .loading::after {
        display: block;
        content: "";
        position: absolute;
        width: 100%;
        height: 100%;
        transform: translateX(-100%);
        background: -webkit-gradient(linear, left top, right top, from(transparent), color-stop(rgba(255, 255, 255, 0.2)), to(transparent));
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        /* Adding animation */
        animation: loading 1s infinite;
    }
    /* Loading Animation */

    @keyframes loading {
        100% {
            transform: translateX(100%);
        }
    }



    .dancin-bc{
    background: white !important;
    height: 100%;
    width: 100%;

    }
    .dancing-lao {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}
.dancing-lao:after {
  display: block;
  width: 150px;
  height: 2px;
  margin-top: 10px;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  border-radius: 10px;
  background: rgb(43, 148, 209);
  content: "";
  -webkit-animation: 1s border infinite;
          animation: 1s border infinite;
  -webkit-animation-timing-function: cubic-bezier(0.92, 0.18, 0.04, 0.92);
          animation-timing-function: cubic-bezier(0.92, 0.18, 0.04, 0.92);
}
.dancing-lao .left-dots {
  position: absolute;
  bottom: 20%;
  left: 20%;
}
.dancing-lao .right-dots {
  position: absolute;
  bottom: 20%;
  right: 20%;
  -webkit-transform: scale(-1, 1);
          transform: scale(-1, 1);
}
.dancing-lao .dot {
  display: inline-block;
  position: absolute;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: rgb(43, 148, 209);
  opacity: 0;
}
.dancing-lao .dot-1 {
  -webkit-animation: 1s dot infinite;
          animation: 1s dot infinite;
  -webkit-animation-delay: .5s;
          animation-delay: .5s;
}
.dancing-lao .dot-2 {
  -webkit-animation: 1s dot-2 infinite;
          animation: 1s dot-2 infinite;
  -webkit-animation-delay: .5s;
          animation-delay: .5s;
}
.dancing-lao .circle-dot {
  display: inline-block;
  position: absolute;
  width: 15px;
  height: 15px;
  border-radius: 50%;
  border: 2px solid rgb(43, 148, 209);
  -webkit-animation: 1s cirle-dot infinite;
          animation: 1s cirle-dot infinite;
  -webkit-animation-delay: .5s;
          animation-delay: .5s;
  opacity: 0;
}
.dancing-lao img {
  display: block;
  margin: auto;
  width: 90px;
  height: 80px;
  margin-bottom: 20px;
  -webkit-animation: 1s dance infinite;
          animation: 1s dance infinite;
  -webkit-animation-timing-function: cubic-bezier(0.92, 0.18, 0.04, 0.92);
          animation-timing-function: cubic-bezier(0.92, 0.18, 0.04, 0.92);
  -webkit-animation-direction: alternate;
          animation-direction: alternate;
}

@-webkit-keyframes dance {
  0% {
    -webkit-transform: translate3d(-10px, -100px, 0) rotate(-15deg) scaleY(1.1);
            transform: translate3d(-10px, -100px, 0) rotate(-15deg) scaleY(1.1);
  }
  50% {
    -webkit-transform: translate3d(0, 8px, 0) scaleY(0.85);
            transform: translate3d(0, 8px, 0) scaleY(0.85);
  }
  100% {
    -webkit-transform: translate3d(10px, -100px, 0) rotate(15deg) scaleY(1.1);
            transform: translate3d(10px, -100px, 0) rotate(15deg) scaleY(1.1);
  }
}

@keyframes dance {
  0% {
    -webkit-transform: translate3d(-10px, -100px, 0) rotate(-15deg) scaleY(1.1);
            transform: translate3d(-10px, -100px, 0) rotate(-15deg) scaleY(1.1);
  }
  50% {
    -webkit-transform: translate3d(0, 8px, 0) scaleY(0.85);
            transform: translate3d(0, 8px, 0) scaleY(0.85);
  }
  100% {
    -webkit-transform: translate3d(10px, -100px, 0) rotate(15deg) scaleY(1.1);
            transform: translate3d(10px, -100px, 0) rotate(15deg) scaleY(1.1);
  }
}
@-webkit-keyframes border {
  0% {
    -webkit-transform: scaleX(1);
            transform: scaleX(1);
    opacity: 0.5;
  }
  50% {
    -webkit-transform: scaleX(0.6);
            transform: scaleX(0.6);
    opacity: 1;
  }
  100% {
    -webkit-transform: scaleX(1);
            transform: scaleX(1);
    opacity: 0.5;
  }
}
@keyframes border {
  0% {
    -webkit-transform: scaleX(1);
            transform: scaleX(1);
    opacity: 0.5;
  }
  50% {
    -webkit-transform: scaleX(0.6);
            transform: scaleX(0.6);
    opacity: 1;
  }
  100% {
    -webkit-transform: scaleX(1);
            transform: scaleX(1);
    opacity: 0.5;
  }
}
@-webkit-keyframes dot {
  0% {
    opacity: 0;
  }
  1% {
    -webkit-transform: scale(0.2);
            transform: scale(0.2);
  }
  50% {
    -webkit-transform: scale(1) translate3d(-50px, -70px, 0);
            transform: scale(1) translate3d(-50px, -70px, 0);
    opacity: .8;
  }
  100% {
    -webkit-transform: scale(1) translate3d(-50px, -70px, 0);
            transform: scale(1) translate3d(-50px, -70px, 0);
    opacity: 0;
  }
}
@keyframes dot {
  0% {
    opacity: 0;
  }
  1% {
    -webkit-transform: scale(0.2);
            transform: scale(0.2);
  }
  50% {
    -webkit-transform: scale(1) translate3d(-50px, -70px, 0);
            transform: scale(1) translate3d(-50px, -70px, 0);
    opacity: .8;
  }
  100% {
    -webkit-transform: scale(1) translate3d(-50px, -70px, 0);
            transform: scale(1) translate3d(-50px, -70px, 0);
    opacity: 0;
  }
}
@-webkit-keyframes dot-2 {
  0% {
    opacity: 0;
  }
  1% {
    -webkit-transform: scale(0.2);
            transform: scale(0.2);
  }
  70% {
    -webkit-transform: scale(0.7) translate3d(-50px, -50px, 0);
            transform: scale(0.7) translate3d(-50px, -50px, 0);
    opacity: .8;
  }
  100% {
    -webkit-transform: scale(0.7) translate3d(-50px, -50px, 0);
            transform: scale(0.7) translate3d(-50px, -50px, 0);
    opacity: 0;
  }
}
@keyframes dot-2 {
  0% {
    opacity: 0;
  }
  1% {
    -webkit-transform: scale(0.2);
            transform: scale(0.2);
  }
  70% {
    -webkit-transform: scale(0.7) translate3d(-50px, -50px, 0);
            transform: scale(0.7) translate3d(-50px, -50px, 0);
    opacity: .8;
  }
  100% {
    -webkit-transform: scale(0.7) translate3d(-50px, -50px, 0);
            transform: scale(0.7) translate3d(-50px, -50px, 0);
    opacity: 0;
  }
}
@-webkit-keyframes cirle-dot {
  0% {
    opacity: 0;
  }
  1% {
    -webkit-transform: scale(0.2);
            transform: scale(0.2);
  }
  80% {
    -webkit-transform: scale(1) translate3d(-80px, -40px, 0);
            transform: scale(1) translate3d(-80px, -40px, 0);
    opacity: .8;
  }
  100% {
    -webkit-transform: scale(1) translate3d(-80px, -40px, 0);
            transform: scale(1) translate3d(-80px, -40px, 0);
    opacity: 0;
  }
}
@keyframes cirle-dot {
  0% {
    opacity: 0;
  }
  1% {
    -webkit-transform: scale(0.2);
            transform: scale(0.2);
  }
  80% {
    -webkit-transform: scale(1) translate3d(-80px, -40px, 0);
            transform: scale(1) translate3d(-80px, -40px, 0);
    opacity: .8;
  }
  100% {
    -webkit-transform: scale(1) translate3d(-80px, -40px, 0);
            transform: scale(1) translate3d(-80px, -40px, 0);
    opacity: 0;
  }
}

</style>




<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title> Teacher - 
        {% block title %}
        {% endblock %}
    </title>    
    <!-- Prevent the demo from appearing in search engines -->
    <meta name="robots" content="noindex">
    <link rel="shortcut icon" href="{%static 'assets/img/favicon.png' %}">

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CRoboto:400,500%7CExo+2:600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.2/css/bulma.min.css">

    <!-- Perfect Scrollbar -->
	
    <link type="text/css" href="{% static 'teacher/assets/vendor/perfect-scrollbar.css' %}" rel="stylesheet">

    <!-- Fix Footer CSS -->
    <link type="text/css" href="{% static 'teacher/assets/vendor/fix-footer.css' %}" rel="stylesheet">

    <!-- Material Design Icons -->
    <link type="text/css" href="{% static 'teacher/assets/css/material-icons.css' %}" rel="stylesheet">


    <!-- Font Awesome Icons -->
    <link type="text/css" href="{% static 'teacher/assets/css/fontawesome.css' %}" rel="stylesheet">


    <!-- Preloader -->
    <link type="text/css" href="{% static 'teacher/assets/css/preloader.css' %}" rel="stylesheet">


    <!-- App CSS -->
    <link type="text/css" href="{% static 'teacher/assets/css/app.css' %}" rel="stylesheet">



    <!-- Flatpickr -->
    <link type="text/css" href="{% static 'teacher/assets/css/flatpickr.css' %}" rel="stylesheet">

    <link type="text/css" href="{% static 'teacher/assets/css/flatpickr-airbnb.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'teacher/assets/css/style.css' %}" rel="stylesheet">

	<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    {% block head %} {% endblock %}

</head>

<body class="layout-mini layout-mini">



    <input type="hidden" id="hd_csrf" value="{{ csrf_token }}">

    <div class="screen hidden">
            <div id="loadings">
    <div class="dancin-bc">
            <div class="dancing-lao">
        <div class="left-dots">
          <div class="dot dot-1"></div>
          <div class="dot dot-2"></div>
          <div class="circle-dot"></div>
        </div>
        <div class="right-dots">
          <div class="dot dot-1"></div>
          <div class="dot dot-2"></div>
          <div class="circle-dot"></div>
        </div>

        <img src="{% static 'assets/img/favicon.png' %}" class="cls-1" alt="">

      </div>
    </div>
</div>

    </div>

    <div class="mdk-drawer-layout js-mdk-drawer-layout" data-push data-responsive-width="992px" style="overflow: scroll;">
        <div class="mdk-drawer-layout__content page-content">

        {% block headercontent %}
        {% endblock %}

        {% block content %}  
        {% endblock %}

        </div>
        <!-- // END drawer-layout__content -->

        {% block modal %}
        {% endblock %}

        {% include './layout/left-sidebar.html' %}
        

    </div>
    <!-- // END drawer-layout -->

{#    <div class="chatbot chatbot--closed">#}
{#        <div class="chatbot__header">#}
{#            <p><strong style="color: white;">Do you need any help?</strong></p>#}
{#            <svg class="chatbot__close-button icon-speech" viewBox="0 0 32 32">#}
{#                <use xlink:href="#icon-speech" />#}
{#            </svg>#}
{#            <svg class="chatbot__close-button icon-close" viewBox="0 0 32 32">#}
{#                <use xlink:href="#icon-close" />#}
{#            </svg>#}
{#        </div>#}
{#        <div class="chatbot__message-window">#}
{#            <ul class="chatbot__messages">#}
{#                <li class="is-ai animation">#}
{#                    <div class="is-ai__profile-picture">#}
{#                        <img src="{% static 'assets/img/favicon.png '%}" alt="">#}
{#                    </div>#}
{#                    <span class="chatbot__arrow chatbot__arrow--left"></span>#}
{#                    <p class='chatbot__message'>Hello there ðŸ™Œ, How we can help you?#}
{##}
{#                    </p>#}
{##}
{#                </li>#}
{#                Message here#}
{#            </ul>#}
{#        </div>#}
{#        <div class="chatbot__entry chatbot--closed">#}
{#            <input type="text" class="chatbot__input" placeholder="Write a message..." />#}
{#            <svg class="chatbot__submit" viewBox="0 0 32 32">#}
{#                <use xlink:href="#icon-send" />#}
{#            </svg>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <svg>#}
{#    <!-- Close icon -->#}
{#        <symbol id="icon-close" viewBox="0 0 32 32">#}
{#            <title>Close</title>#}
{#            <path d="M2.624 8.297l2.963-2.963 23.704 23.704-2.963 2.963-23.704-23.704z" />#}
{#            <path d="M2.624 29.037l23.704-23.704 2.963 2.963-23.704 23.704-2.963-2.963z" />#}
{#        </symbol>#}
{##}
{#        <!-- Speech icon -->#}
{#        <symbol id="icon-speech" viewBox="0 0 32 32">#}
{#            <title>Speech</title>#}
{#            <path d="M21.795 5.333h-11.413c-0.038 0-0.077 0-0.114 0l-0.134 0.011v2.796c0.143-0.006 0.273-0.009 0.385-0.009h11.277c0.070 0 7.074 0.213 7.074 7.695 0 5.179-2.956 7.695-9.036 7.695h-3.792c-0.691 0-1.12 0.526-1.38 1.159l-1.387 3.093-1.625 3.77 0.245 0.453h2.56l2.538-5.678h2.837c7.633 0 11.84-3.727 11.84-10.494 0.001-8.564-7.313-10.492-9.875-10.492z" />#}
{#            <path d="M10.912 24.259c-0.242-0.442-0.703-0.737-1.234-0.737-0 0-0 0-0 0h-0.56c-0.599-0.011-1.171-0.108-1.71-0.28l0.042 0.012c-1.82-0.559-4.427-2.26-4.427-7.424 0-6.683 5.024-7.597 7.109-7.686v-2.8c-2.042 0.095-9.91 1.067-9.91 10.483 0 4.832 1.961 7.367 3.606 8.64 1.38 1.067 3.109 1.744 4.991 1.843l0.033 0.019 2.805 5.211 1.41-3.273z" />#}
{#        </symbol>#}
{##}
{#        <!-- Send icon -->#}
{#        <symbol id="icon-send" viewBox="0 0 23.97 21.9">#}
{#            <title>Send</title>#}
{#            <path d="M0.31,9.43a0.5,0.5,0,0,0,0,.93l8.3,3.23L23.15,0Z"/>#}
{#            <path d="M9,14.6H9V21.4a0.5,0.5,0,0,0,.93.25L13.22,16l6,3.32A0.5,0.5,0,0,0,20,19l4-18.4Z"/>#}
{#        </symbol>#}
{##}
{#        <!-- Avatar icon -->#}
{#        <symbol id="avatar" width="44.25" height="44" viewBox="0 0 44.25 44">#}
{#            <title>Avatar</title>#}
{#            <path style="fill: #7226e0; fill-rule: evenodd;" d="M1035.88,1696.25a22,22,0,1,1-22.13,22A22.065,22.065,0,0,1,1035.88,1696.25Z" transform="translate(-1013.75 -1696.25)"/>#}
{#            <path style="fill: #fff; fill-rule: evenodd;" d="M1030.18,1725.16h2.35a0.335,0.335,0,0,0,.34-0.33v-5.23h5.94v5.23a0.342,0.342,0,0,0,.34.33h2.36a0.342,0.342,0,0,0,.34-0.33v-12.36a0.34,0.34,0,0,0-.34-0.32h-2.36a0.34,0.34,0,0,0-.34.32v4.51h-5.94v-4.51a0.333,0.333,0,0,0-.34-0.32h-2.35a0.333,0.333,0,0,0-.34.32v12.36a0.335,0.335,0,0,0,.34.33" transform="translate(-1013.75 -1696.25)"/>#}
{#        </symbol>#}
{##}
{#    </svg>#}

    <!-- <div class="chatbot chatbot--closed"> -->
        <!-- <div class="chatbot__header"> -->
            <!-- <p><strong style="color: white;">Do you need any help?</strong></p> -->
            <!-- <svg class="chatbot__close-button icon-speech" viewBox="0 0 32 32"> -->
                <!-- <use xlink:href="#icon-speech" /> -->
            <!-- </svg> -->
            <!-- <svg class="chatbot__close-button icon-close" viewBox="0 0 32 32"> -->
                <!-- <use xlink:href="#icon-close" /> -->
            <!-- </svg> -->
        <!-- </div> -->
        <!-- <div class="chatbot__message-window"> -->
            <!-- <ul class="chatbot__messages"> -->
                <!-- <li class="is-ai animation"> -->
                    <!-- <div class="is-ai__profile-picture"> -->
                        <!-- <img src="{% static 'assets/img/favicon.png '%}" alt=""> -->
                    <!-- </div> -->
                    <!-- <span class="chatbot__arrow chatbot__arrow--left"></span> -->
                    <!-- <p class='chatbot__message'>Hello there ðŸ™Œ, How we can help you? -->

                    <!-- </p> -->

                <!-- </li> -->
                <!-- Message here -->
            <!-- </ul> -->
        <!-- </div> -->
        <!-- <div class="chatbot__entry chatbot--closed"> -->
            <!-- <input type="text" class="chatbot__input" placeholder="Write a message..." /> -->
            <!-- <svg class="chatbot__submit" viewBox="0 0 32 32"> -->
                <!-- <use xlink:href="#icon-send" /> -->
            <!-- </svg> -->
        <!-- </div> -->
    <!-- </div> -->

    <!-- Symbols -->
    <!-- <svg> -->
        <!-- Close icon -->
        <!-- <symbol id="icon-close" viewBox="0 0 32 32"> -->
            <!-- <title>Close</title> -->
            <!-- <path d="M2.624 8.297l2.963-2.963 23.704 23.704-2.963 2.963-23.704-23.704z" /> -->
            <!-- <path d="M2.624 29.037l23.704-23.704 2.963 2.963-23.704 23.704-2.963-2.963z" /> -->
        <!-- </symbol> -->
    
        <!-- Speech icon -->
        <!-- <symbol id="icon-speech" viewBox="0 0 32 32"> -->
            <!-- <title>Speech</title> -->
            <!-- <path d="M21.795 5.333h-11.413c-0.038 0-0.077 0-0.114 0l-0.134 0.011v2.796c0.143-0.006 0.273-0.009 0.385-0.009h11.277c0.070 0 7.074 0.213 7.074 7.695 0 5.179-2.956 7.695-9.036 7.695h-3.792c-0.691 0-1.12 0.526-1.38 1.159l-1.387 3.093-1.625 3.77 0.245 0.453h2.56l2.538-5.678h2.837c7.633 0 11.84-3.727 11.84-10.494 0.001-8.564-7.313-10.492-9.875-10.492z" /> -->
            <!-- <path d="M10.912 24.259c-0.242-0.442-0.703-0.737-1.234-0.737-0 0-0 0-0 0h-0.56c-0.599-0.011-1.171-0.108-1.71-0.28l0.042 0.012c-1.82-0.559-4.427-2.26-4.427-7.424 0-6.683 5.024-7.597 7.109-7.686v-2.8c-2.042 0.095-9.91 1.067-9.91 10.483 0 4.832 1.961 7.367 3.606 8.64 1.38 1.067 3.109 1.744 4.991 1.843l0.033 0.019 2.805 5.211 1.41-3.273z" /> -->
        <!-- </symbol> -->
    
        <!-- Send icon -->
        <!-- <symbol id="icon-send" viewBox="0 0 23.97 21.9"> -->
            <!-- <title>Send</title> -->
            <!-- <path d="M0.31,9.43a0.5,0.5,0,0,0,0,.93l8.3,3.23L23.15,0Z"/> -->
            <!-- <path d="M9,14.6H9V21.4a0.5,0.5,0,0,0,.93.25L13.22,16l6,3.32A0.5,0.5,0,0,0,20,19l4-18.4Z"/> -->
        <!-- </symbol> -->
    
        <!-- Avatar icon -->
        <!-- <symbol id="avatar" width="44.25" height="44" viewBox="0 0 44.25 44"> -->
            <!-- <title>Avatar</title> -->
            <!-- <path style="fill: #7226e0; fill-rule: evenodd;" d="M1035.88,1696.25a22,22,0,1,1-22.13,22A22.065,22.065,0,0,1,1035.88,1696.25Z" transform="translate(-1013.75 -1696.25)"/> -->
            <!-- <path style="fill: #fff; fill-rule: evenodd;" d="M1030.18,1725.16h2.35a0.335,0.335,0,0,0,.34-0.33v-5.23h5.94v5.23a0.342,0.342,0,0,0,.34.33h2.36a0.342,0.342,0,0,0,.34-0.33v-12.36a0.34,0.34,0,0,0-.34-0.32h-2.36a0.34,0.34,0,0,0-.34.32v4.51h-5.94v-4.51a0.333,0.333,0,0,0-.34-0.32h-2.35a0.333,0.333,0,0,0-.34.32v12.36a0.335,0.335,0,0,0,.34.33" transform="translate(-1013.75 -1696.25)"/> -->
        <!-- </symbol> -->
    
    <!-- </svg> -->

    <!-- Axios -->
    <script src="{% static 'assets/js/axios.min.js' %}"></script>

    <!-- jQuery -->
    <script src="{% static 'teacher/assets/vendor/jquery.min.js' %}"></script>

    <!-- Bootstrap -->
    <script src="{% static 'teacher/assets/vendor/popper.min.js' %}"></script>
    <script src="{% static 'teacher/assets/vendor/bootstrap.min.js' %}"></script>

    <!-- Perfect Scrollbar -->
    <script src="{% static 'teacher/assets/vendor/perfect-scrollbar.min.js' %}"></script>

    <!-- DOM Factory -->
    <script src="{% static 'teacher/assets/vendor/dom-factory.js' %}"></script>

    <!-- MDK -->
    <script src="{% static 'teacher/assets/vendor/material-design-kit.js' %}"></script>

    <!-- Fix Footer -->
    <script src="{% static 'teacher/assets/vendor/fix-footer.js' %}"></script>

    <!-- App JS -->
    <script src="{% static 'teacher/assets/js/app.js' %}"></script>






    <!-- Global Settings -->
    <script src="{% static 'teacher/assets/js/settings.js' %}"></script>

    <!-- Moment.js -->
    <script src="{% static 'teacher/assets/vendor/moment.min.js' %}"></script>
    <script src="{% static 'teacher/assets/vendor/moment-range.min.js' %}"></script>

    <!-- Flatpickr -->
    <script src="{% static 'teacher/assets/vendor/flatpickr/flatpickr.min.js' %}"></script>
    <script src="{% static 'teacher/assets/js/flatpickr.js' %}"></script>

    

    <!-- List.js -->
    <script src="{% static 'teacher/assets/vendor/list.min.js' %}"></script>
    <script src="{% static 'teacher/assets/js/list.js' %}"></script>

    <!-- Tables -->
    <script src="{% static 'teacher/assets/js/toggle-check-all.js' %}"></script>
    <script src="{% static 'teacher/assets/js/check-selected-row.js' %}"></script>

    <!-- Sidebar Mini JS -->
    <script src="{% static 'teacher/assets/js/sidebar-mini.js' %}"></script>
    
	<!------------------------Fire Store------------------------>
	
	<script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-app.js"></script>

	<!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
	<script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-analytics.js"></script>

	<!-- Add Firebase products that you want to use -->
	<script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-firestore.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-storage.js"></script>
	<script src="{% static 'firebase_init.js' %}"></script>

	
	
	
</body>



</html>	
	
{% block script %}{% endblock %}

<script>
$(function() {
    'use strict';

    // ENABLE sidebar menu tabs
    $('.js-sidebar-mini-tabs [data-toggle="tab"]').on('click', function(e) {
        e.preventDefault()
        $(this).tab('show')
    })

    $('.js-sidebar-mini-tabs').on('show.bs.tab', function(e) {
        $('.js-sidebar-mini-tabs > .active').removeClass('active')
        $(e.target).parent().addClass('active')
    })
});
//})()
</script>
<script>
    $.ajaxSetup({
        headers: {
            'X-CSRFToken': $("#hd_csrf").val(),
        }
    });
    let config = {
        headers: {'X-CSRFToken': $("#hd_csrf").val()},
    };
</script>
<script>

    var Botkit = require('botkit');

    var controller = new Botkit({});


    controller.hears('hello', 'message', async(bot, message) => {

        await bot.reply(message, 'Howdy!');

    })
    // Tell the bot to listen for users saying "hello," and use `bot.reply` to send an immediate response.


    const tacos = new BotkitConversation('tacos', controller);
    tacos.say('Oh boy, taco time!');
    tacos.ask('What type of taco do you want?', async(answer, convo, bot) => {

        // do something with the answer!

    }, 'type_of_taco');
    tacos.say('Yum!!');
    controller.addDialog(tacos);

    controller.hears('tacos', 'message', async(bot, message) => {
        await bot.beginDialog('tacos');
    });
</script>
<script>
    const accessToken = "2af13bcd195349aba75a1c003d0dd75b";
    const baseUrl = "https://api.api.ai/api/query?v=20150910";
    const sessionId = "1234567890";
    const loadingMarkups = "<span class='loader'><span class='loader__dot'></span><span class='loader__dot'></span><span class='loader__dot'></span></span>";
    const errorMessage = "Stay around while we repling..";
    const urlPattern = /(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;
    const loadingDelay = 700;
    const aiReplyDelay = 1800;
    const $document = document;
    const $chatbot = $document.querySelector(".chatbot");
    const $chatbotMessageWindow = $document.querySelector(".chatbot__message-window");
    const $chatbotHeader = $document.querySelector(".chatbot__header");
    const $chatbotMessages = $document.querySelector(".chatbot__messages");
    const $chatbotInput = $document.querySelector(".chatbot__input");
    const $chatbotSubmit = $document.querySelector(".chatbot__submit");

        /*$chatbotHeader.addEventListener("click", () => {
            toggle($chatbot, "chatbot--closed");
            $chatbotInput.focus();
        }, false);*/

        document.addEventListener("keypress", event => {
            if (event.which === 13) {
                validateMessage();
            }
        }, false);

        /*$chatbotSubmit.addEventListener("click", () => {
            validateMessage();
        }, false);*/

        let toggle = (element, klass) => {
            let classes = element.className.match(/\S+/g) || [],
                index = classes.indexOf(klass);
            if (index >= 0) {
                classes.splice(index, 1);
            } else {
                classes.push(klass);
            }
            element.className = classes.join(" ");
        };

        let userMessage = content => {
            $chatbotMessages.innerHTML += `
          <li class='is-user animation'>

        <p class='chatbot__message'>
          ${content}
        </p>
        <span class='chatbot__arrow chatbot__arrow--right'></span>
        <img src="./../static{{user.image}}" style="border:2px solid grey;margin-left:5px;width:40px;float:right;height:40px;border-radius:50%" />

      </li>`;
        };

        let aiMessage = (content, isLoading = false, delay = 0) => {
            setTimeout(() => {
                removeLoader();
                $chatbotMessages.innerHTML += `<li
            class='is-ai animation'
            id='${isLoading ? "is-loading" : ""}'>
              <div class="is-ai__profile-picture">
                 <img src="../../assets/img/favicon.png" alt="">
              </div>
              <span class='chatbot__arrow chatbot__arrow--left'></span>
              <div class='chatbot__message'>
                ${content}
                <small style="position:absolute;right:40px;bottom:5px;color: grey;"><b>now</b></small>

              </div>
            </li>

            `;
                scrollDown();
            }, delay);
        };

        let removeLoader = () => {
            let loadingElem = document.getElementById("is-loading");
            if (loadingElem) {
                $chatbotMessages.removeChild(loadingElem);
            }
        };

        let escapeScript = unsafe => {
            let safeString = unsafe.replace(/</g, " ")
                .replace(/>/g, " ")
                .replace(/&/g, " ")
                .replace(/"/g, " ")
                .replace(/\\/, " ")
                .replace(/\s+/g, " ");
            return safeString.trim();
        };

        let linkify = inputText => {
            return inputText.replace(urlPattern, '<a href="$1" target="_blank">$1</a>');
        };

        let validateMessage = () => {
            let text = $chatbotInput.value;
            let safeText = text ? escapeScript(text) : "";
            if (safeText.length && safeText !== " ") {
                resetInputField();
                userMessage(safeText);
                send(safeText);
            }
            scrollDown();
            return;
        };

        let multiChoiceAnswer = text => {
            let decodedText = text.replace(/zzz/g, "'");
            userMessage(decodedText);
            send(decodedText);
            scrollDown();
            return;
        };

        let processResponse = val => {
            removeLoader();
            if (val.fulfillment) {
                let output = "";
                let messagesLength = val.fulfillment.messages.length;
                for (let i = 0; i < messagesLength; i++) {
                    let message = val.fulfillment.messages[i];
                    let type = message.type;
                    switch (type) {
                        // 0 fulfillment is text
                        case 0:
                            let parsedText = linkify(message.speech);
                            output += `<p>${parsedText}</p>`;
                            break;
                            // 1 fulfillment is card
                        case 1:
                            // let imageUrl = message.imageUrl
                            // let imageTitle = message.title
                            // let imageSubtitle = message.subtitle
                            // output += `<img src="${imageUrl}" alt="${imageTitle}${imageSubtitle}" />`
                            break;
                            // 2 fulfillment is button list
                        case 2:
                            let title = message.title;
                            let replies = message.replies;
                            let repliesLength = replies.length;
                            output += `<p>${title}</p>`;
                            for (let i = 0; i < repliesLength; i++) {
                                let reply = replies[i];
                                let encodedText = reply.replace(/'/g, "zzz");
                                output += `<button onclick='multiChoiceAnswer("${encodedText}")'>${reply}</button>`;
                            }
                            break;
                            // 3 fulfillment is image
                        case 3:
                            // console.log("Fulfillment is image - TODO")
                            break;
                    }
                }
                return output;
            } else {
                return val;
            }
        };

        let setResponse = (val, delay = 0) => {
            setTimeout(() => {
                aiMessage(processResponse(val));
            }, delay);
        };

        let resetInputField = () => {
            $chatbotInput.value = "";
        };

        let scrollDown = () => {
            let distanceToScroll = $chatbotMessageWindow.scrollHeight - ($chatbotMessages.lastChild.offsetHeight + 60);
            $chatbotMessageWindow.scrollTop = distanceToScroll;
            return false;
        };

        let send = (text) => {
            fetch(`${baseUrl}&query=${text}&lang=en&sessionId=${sessionId}`, {
                    method: "GET",
                    dataType: "json",
                    headers: {
                        Authorization: "Bearer " + accessToken,
                        "Content-Type": "application/json; charset=utf-8"
                    }
                })
                .then(response => response.json())
                .then(res => {
                    if (res.status < 200 || res.status >= 300) {
                        let error = new Error(res.statusText);
                        throw error;
                    }
                    return res;
                }).then(res => {
                    // console.log(JSON.stringify(response.result, undefined, 2))
                    setResponse(res.result, loadingDelay + aiReplyDelay);
                }).catch(error => {
                    setResponse(errorMessage, loadingDelay + aiReplyDelay);
                    resetInputField();
                    //console.log( error );
                });
            aiMessage(loadingMarkups, true, loadingDelay);
        };
</script>
<script>
    $(document).ready(function() {
        var color = localStorage.getItem('mode');
        console.log(color);
        color_mode();
    });

    let head = document.getElementsByTagName('HEAD')[0];

        // Create new link Element
    let link = document.createElement('link');

    // set the attributes for link element
    link.rel = 'stylesheet';

    link.type = 'text/css';

    link.href = "/static/{{lang}}teacher/assets/css/dark.css";

    function color_mode()
        {
            if (localStorage.getItem('mode') == 'dark') {
                head.appendChild(link);

            } else {
                head.removeChild(link);
            }
        }
</script>
<script>
/*
var Config = {
	apiKey: "AIzaSyAoBR3g9AXuF2GXzlgsJ5DWGiQW1sPdk9g",
	authDomain: "booctop.firebaseio.com",
	databaseURL: "https://booctop.firebaseio.com/",
	projectId: "booctop",
	storageBucket: "booctop.appspot.com",
};

// Initialize Firebase
var defaultProject = firebase.initializeApp(Config);
var db = firebase.firestore();*/

{#<!----------------------------------------Teacher Side------------------------------------------->#}

$(document).ready(function(){

    $('#send_button').attr('disabled', true);
    $('#text_message').attr('disabled', true);

    $('#loadings').fadeOut(3000);

});

async function student_info(cname){

	$(".bg-light").removeClass("bg-light");
	$(cname).addClass("bg-light");

	var student_id = $(cname).attr("data-student-id");
	var course_id = $(cname).attr("data-course-id");
	var course_name = $(cname).attr("data-course-name");
	var student_name = $(cname).attr("data-student-name");
	var student_img = $(cname).attr("data-student-img");
	var teacher_id = $("#teacher_id").val()

	$('#name_student').text(student_name)
	$('#name_course').text(course_name)

	$(".avatar.avatar-online.avatar-sm").find("img").attr("src","../../../static"+student_img)

	$('#student_id').val(student_id)
	$('#course_id').val(course_id)
	$('#course_name').val(course_name)
	$('#student_img').val(student_img)
	$('#student_name').val(student_name)

	$('#send_button').attr('disabled', false);
	$('#text_message').attr('disabled', false);

    messages_list = ""
    $('#msg_div').html("");
    console.log("aaaaaa"+db);

    const ref_1 = await db.collection("ChatMessages").where('sender_id', '==', student_id).where('receiver_id', '==', teacher_id).where('course_id', '==', course_id).get();

    const ref_2 = await db.collection("ChatMessages").where('sender_id', '==', teacher_id).where('receiver_id', '==', student_id).where('course_id', '==', course_id).get();

    console.log("test1=>"+ref_1);
    console.log("test2=>"+ref_2);

	if (ref_1.empty){
		messages_list = ""
		db.collection("ChatMessages").where('sender_id', '==', teacher_id).where('receiver_id' , '==',  student_id).where('course_id' , '==', course_id)
		.onSnapshot(function(querySnapshot) {
            includeMetadataChanges: true;
            messages_list +='<ul class="d-flex flex-column list-unstyled" id="messages">'
            querySnapshot.forEach(function(doc) {
                doc.data()['message'].forEach(function(messages){
                    console.log(messages)

                    if( messages['sender_id'] == teacher_id ){

                        console.log("1")

                        messages_list += ' <li class="message teacher d-inline-flex" >'

                        //messages_list += '<div class="message__aside">'
                            //messages_list += '<a href="mini-profile.html" class="avatar avatar-sm">'
                            //messages_list += '<img alt="people" class="avatar-img rounded-circle">'
                            //messages_list += '</a>'
                        //messages_list += '</div>'

                        messages_list += '<div class="message__body card">'

                        messages_list += '<div class="card-body">'
                        messages_list += '<div class="d-flex align-items-center">'
                            messages_list += '<div class="flex mr-3">'
                            messages_list += '<a class="text-body"><strong>'+doc.data()['sender_name']+'</strong></a>'
                            messages_list += '</div>'
                            messages_list += '<div>'
                            messages_list += '<small class="text-50">'+messages['date']+" "+messages['time'].replace(/:\d+ (\w\w)$/,' $1')+'</small>'
                            messages_list += '</div>'
                        messages_list += '</div>'

                        messages_list +=  '<span class="text-70">'+messages['message']+'</span>'


                        if(messages['file_url']){


                        messages_list +=  '<a href  = '+messages['file_url']+' target="_blank" class="media align-items-center mt-2 text-decoration-0 px-3">'

                        messages_list +=  '<span class="avatar mr-12pt">'

                            messages_list +=  '<span class="avatar-title rounded-circle">'
                            messages_list +=  '<i class="material-icons font-size-24pt">attach_file</i>'
                            messages_list +=  '</span>'
                        messages_list +=  '</span>'

                        messages_list +=  '<span class="media-body" style="line-height: 1.5">'
                            messages_list +=  '<span class="text-primary">draft.sketch</span><br>'
                            messages_list +=  '<span class="text-50"></span>'
                        messages_list +=  ' </span>'

                        messages_list +=  '</a>'


                        }


                        messages_list +=  '</div>'
                        messages_list +=  '</div>'
                        messages_list +=  '</li>'

                    }

                    else if ( messages['sender_id'] == student_id ) {

                            console.log("2")

                            messages_list += '<li class="message d-inline-flex">'

                            //messages_list += '<div class="message__aside">'
                                //messages_list += '<a href="mini-profile.html" class="avatar avatar-sm">'
                                //messages_list += '<img alt="people" class="avatar-img rounded-circle">'
                                //messages_list += '</a>'
                            //messages_list += '</div>'

                            messages_list += '<div class="message__body card">'

                            messages_list += '<div class="card-body">'
                            messages_list += '<div class="d-flex align-items-center">'
                                messages_list += '<div class="flex mr-3">'
                                messages_list += '<a class="text-body"><strong>'+doc.data()['receiver_name']+'</strong></a>'

                                messages_list += '</div>'
                                messages_list += '<div>'
                                messages_list += '<small class="text-50">'+messages['date']+" "+messages['time'].replace(/:\d+ (\w\w)$/,' $1')+'</small>'
                                messages_list += '</div>'
                            messages_list += '</div>'

                            messages_list +=  '<span class="text-70">'+messages['message']+'</span>'



                            if(messages['file_url']){

                            messages_list +=  '<a href  = '+messages['file_url']+' target="_blank" class="media align-items-center mt-2 text-decoration-0 px-3">'

                            messages_list +=  '<span class="avatar mr-12pt">'

                                messages_list +=  '<span class="avatar-title rounded-circle">'
                                messages_list +=  '<i class="material-icons font-size-24pt">attach_file</i>'
                                messages_list +=  '</span>'
                            messages_list +=  '</span>'

                            messages_list +=  '<span class="media-body" style="line-height: 1.5">'
                                messages_list +=  '<span class="text-primary">draft.sketch</span><br>'
                                messages_list +=  '<span class="text-50"></span>'
                            messages_list +=  ' </span>'

                            messages_list +=  '</a>'

                            }


                            messages_list +=  '</div>'
                            messages_list +=  '</div>'
                            messages_list +=  '</li>'



                        }
                });
			});

			messages_list +="</ul>"
			$('#msg_div').html("");
			$('#msg_div').html(messages_list);
			messages_list = ""

			var height = $("#msg_div").height()+200;
			$(".ps--active-y").scrollTop(height);

		});
	}

	else{
		messages_list = ""
		db.collection("ChatMessages").where('sender_id', '==', student_id).where('receiver_id' , '==',  teacher_id).where('course_id' , '==', course_id)
		.onSnapshot(function(querySnapshot) {
            includeMetadataChanges: true;
            messages_list +='<ul class="d-flex flex-column list-unstyled" id="messages">'
            querySnapshot.forEach(function(doc) {
            doc.data()['message'].forEach(function(messages){
            console.log(messages)

            if( messages['sender_id'] == teacher_id ){

                messages_list += ' <li class="message teacher d-inline-flex" >'

                //messages_list += '<div class="message__aside">'
                    //messages_list += '<a href="mini-profile.html" class="avatar avatar-sm">'
                    //messages_list += '<img alt="people" class="avatar-img rounded-circle">'
                    //messages_list += '</a>'
                //messages_list += '</div>'

                messages_list += '<div class="message__body card">'

                messages_list += '<div class="card-body">'
                messages_list += '<div class="d-flex align-items-center">'
                messages_list += '<div class="flex mr-3">'
                messages_list += '<a class="text-body"><strong>'+doc.data()['receiver_name']+'</strong></a>'
                messages_list += '</div>'
                messages_list += '<div>'
                messages_list += '<small class="text-50">'+messages['date']+" "+messages['time'].replace(/:\d+ (\w\w)$/,' $1')+'</small>'
                messages_list += '</div>'
                messages_list += '</div>'

                messages_list +=  '<span class="text-70">'+messages['message']+'</span>'


                if(messages['file_url']){
                    messages_list +=  '<a href  = '+messages['file_url']+' target="_blank" class="media align-items-center mt-2 text-decoration-0 px-3">'

                    messages_list +=  '<span class="avatar mr-12pt">'

                    messages_list +=  '<span class="avatar-title rounded-circle">'
                    messages_list +=  '<i class="material-icons font-size-24pt">attach_file</i>'
                    messages_list +=  '</span>'
                    messages_list +=  '</span>'

                    messages_list +=  '<span class="media-body" style="line-height: 1.5">'
                    messages_list +=  '<span class="text-primary">draft.sketch</span><br>'
                    messages_list +=  '<span class="text-50"></span>'
                    messages_list +=  ' </span>'

                    messages_list +=  '</a>'

                }
                messages_list +=  '</div>'
                messages_list +=  '</div>'
                messages_list +=  '</li>'

            }

            else if ( messages['sender_id'] == student_id ) {

                console.log("4")

                messages_list += '<li class="message d-inline-flex">'

                //messages_list += '<div class="message__aside">'
                    //messages_list += '<a href="mini-profile.html" class="avatar avatar-sm">'
                    //messages_list += '<img alt="people" class="avatar-img rounded-circle">'
                    //messages_list += '</a>'
                //messages_list += '</div>'

                messages_list += '<div class="message__body card">'

                messages_list += '<div class="card-body">'
                messages_list += '<div class="d-flex align-items-center">'
                    messages_list += '<div class="flex mr-3">'
                    messages_list += '<a class="text-body"><strong>'+doc.data()['sender_name']+'</strong></a>'

                    messages_list += '</div>'
                    messages_list += '<div>'
                    messages_list += '<small class="text-50">'+messages['date']+" "+messages['time'].replace(/:\d+ (\w\w)$/,' $1')+'</small>'
                    messages_list += '</div>'
                messages_list += '</div>'

                messages_list +=  '<span class="text-70">'+messages['message']+'</span>'


                if(messages['file_url']){


                messages_list +=  '<a href  = '+messages['file_url']+' target="_blank" class="media align-items-center mt-2 text-decoration-0 px-3">'

                messages_list +=  '<span class="avatar mr-12pt">'

                    messages_list +=  '<span class="avatar-title rounded-circle">'
                    messages_list +=  '<i class="material-icons font-size-24pt">attach_file</i>'
                    messages_list +=  '</span>'
                messages_list +=  '</span>'

                messages_list +=  '<span class="media-body" style="line-height: 1.5">'
                    messages_list +=  '<span class="text-primary">draft.sketch</span><br>'
                    messages_list +=  '<span class="text-50"></span>'
                messages_list +=  ' </span>'

                messages_list +=  '</a>'


                }

                messages_list +=  '</div>'
                messages_list +=  '</div>'
                messages_list +=  '</li>'

            }

            });


        });

        messages_list +="</ul>"
        $('#msg_div').html("");
        $('#msg_div').html(messages_list);
        messages_list = ""

        var height = $("#msg_div").height()+200;
        $(".ps--active-y").scrollTop(height);

    });

	}
}

let storageRef_student_1 = firebase.storage().ref('files')
async function massage_teacher_to_student(){

	var student_id = $("#student_id").val()
	var course_id = $("#course_id").val()
	var course_name = $("#course_name").val()
	var student_name = $("#student_name").val()
	var message = $("#text_message").val()
	var teacher_name = "{{user_name}}"
	var teacher_id = $("#teacher_id").val()

	var file = document.getElementById("customFile").files[0]

	if (file == null){

		if (message == ""){

			$("#text_message").focus();

			}

		else{

				var sender_seen = 0
				var reciver_seen = 0

				var reciver_profile = ""
				var key = ""

				var file_type = "text"

				var today = new Date();
				var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
				var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
				var dateTime = date+' '+time;


				var message_date = new Date().toLocaleDateString('en-GB');
				var message_time = new Date().toLocaleTimeString();

				var chat_messages1 = db.collection("ChatMessages").where('sender_id', '==', teacher_id).where('receiver_id', '==', student_id).where('course_id', '==', course_id)

				var chat_messages2 = db.collection("ChatMessages").where('sender_id', '==', student_id).where('receiver_id', '==', teacher_id).where('course_id', '==', course_id)


				message_data = {

							date : message_date,

							file_type :"text",
							key : "",

							message : message,
							course_id : course_id,

							file_url : "",

							sender_id : teacher_id,
							time : message_time,

						}

				let chat_messages1_obj = await chat_messages1.get();

				let chat_messages2_obj = await chat_messages2.get();


				if (chat_messages1_obj.empty && chat_messages2_obj.empty ) {

						db.collection("ChatMessages").add({

						date_time : dateTime,

						message : [message_data],
						course_id : course_id,

						receiver_name : student_name,
						receiver_id : student_id,

						receiver_profile : "",
						receiver_seen : 1,

						sender_name : teacher_name,
						sender_id : teacher_id,

						sender_profile :"" ,
						sender_seen : 0,

						})
						.then(function(docRef) {
							console.log("Document written with ID: ", docRef);
						})
						.catch(function(error) {
							console.error("Error adding document: ", error);
						});

					}



				else{
					const increment = firebase.firestore.FieldValue.increment(1);
					var doc_id = "";


					const ref_1 = await db.collection("ChatMessages").where('sender_id', '==', teacher_id).where('receiver_id', '==', student_id).where('course_id', '==', course_id).get()

					const ref_2 = await db.collection("ChatMessages").where('sender_id', '==', student_id).where('receiver_id', '==',teacher_id).where('course_id', '==', course_id).get()

					if (ref_1.empty) {

					const docRefId = ref_2.docs[0].id;

					db.collection("ChatMessages").doc(docRefId).update({
						message : firebase.firestore.FieldValue.arrayUnion(message_data),
						sender_seen : increment
					})

					}

				else{

					const docRefId = ref_1.docs[0].id;

					db.collection("ChatMessages").doc(docRefId).update({
						message : firebase.firestore.FieldValue.arrayUnion(message_data),
						receiver_seen : increment

					})
				}
				}

				$('#text_message').val("");
				$('#'+course_id+'_teacher_side_div').click();

		}


	}

	else{

		$('#loadings').show();

		let firstFile = document.getElementById("customFile").files[0]

		let selected_file_name = file.name

		console.log(firstFile)

		var file_type = selected_file_name.replace(/^.*\./, '');

		console.log(file_type)

		let uploadTask;

		var path_downloadURL = ""

		if(file_type == "application/pdf"){

			$('#loadings').show();
			var metadata = {
			contentType: 'application/pdf'
			};
			uploadTask = storageRef_student_1.child('pdf'+Math.random()+'.pdf').put(firstFile, metadata)
			uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED,

			function progress(snapshot) {
					$('#loadings').show();
					var percentage = snapshot.bytesTransferred / snapshot.totalBytes * 100;
					console.log("percentage uploading file: " + percentage);
				},
				function error(err) {
					$('#loadings').show();
					console.log(err);
				},
				function complete() {

					uploadTask.snapshot.ref.getDownloadURL().then(function (downloadURL) {


						send_message_with_attachemt_1(downloadURL,message,teacher_id,student_id,course_id,teacher_name,student_name)



					})

				}

			)

			}
		else{
			$('#loadings').show();
			uploadTask = storageRef_student_1.child('image'+Math.random()+'.jpg').put(firstFile)
			uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED,

				function progress(snapshot) {
					$('#loadings').show();
					var percentage = snapshot.bytesTransferred / snapshot.totalBytes * 100;
					console.log("percentage uploading file: " + percentage);
				},
				function error(err) {
					$('#loadings').show();
					console.log(err);
				},
				function complete() {

					uploadTask.snapshot.ref.getDownloadURL().then(function (downloadURL) {
						console.log("Finished uploading file: " + downloadURL);
						send_message_with_attachemt_1(downloadURL,message,teacher_id,student_id,course_id,teacher_name,student_name)
					})

				}

			)
		}

	}
}

async function send_message_with_attachemt_1(downloadURL,message,teacher_id,student_id,course_id,teacher_name,student_name){
    if (message == ""){

            $("#text_message").focus();

            }
    else{
            var sender_seen = 0
            var reciver_seen = 0

            var reciver_profile = ""
            var key = ""

            var file_type = "text"

            var today = new Date();
            var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
            var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
            var dateTime = date+' '+time;


            var message_date = new Date().toLocaleDateString('en-GB');
            var message_time = new Date().toLocaleTimeString();

            var chat_messages1 = db.collection("ChatMessages").where('sender_id', '==', teacher_id).where('receiver_id', '==', student_id).where('course_id', '==', course_id)

            var chat_messages2 = db.collection("ChatMessages").where('sender_id', '==', student_id).where('receiver_id', '==', teacher_id).where('course_id', '==', course_id)


            message_data = {

                        date : message_date,

                        file_type :"text",
                        key : "",

                        message : message,
                        course_id : course_id,

                        file_url : downloadURL,

                        sender_id : teacher_id,
                        time : message_time,

                    }

            let chat_messages1_obj = await chat_messages1.get();

            let chat_messages2_obj = await chat_messages2.get();


            if (chat_messages1_obj.empty && chat_messages2_obj.empty ) {
                db.collection("ChatMessages").add({

                date_time : dateTime,

                message : [message_data],
                course_id : course_id,

                receiver_name : student_name,
                receiver_id : student_id,

                receiver_profile : "",
                receiver_seen : 1,

                sender_name : teacher_name,
                sender_id : teacher_id,

                sender_profile :"" ,
                sender_seen : 0,

                })
                .then(function(docRef) {
                    console.log("Document written with ID: ", docRef);
                })
                .catch(function(error) {
                    console.error("Error adding document: ", error);
                });

            }
            else{
                const increment = firebase.firestore.FieldValue.increment(1);
                var doc_id = "";

                const ref_1 = await db.collection("ChatMessages").where('sender_id', '==', teacher_id).where('receiver_id', '==', student_id).where('course_id', '==', course_id).get()

                const ref_2 = await db.collection("ChatMessages").where('sender_id', '==', student_id).where('receiver_id', '==',teacher_id).where('course_id', '==', course_id).get()

                if (ref_1.empty) {

                const docRefId = ref_2.docs[0].id;

                db.collection("ChatMessages").doc(docRefId).update({
                    message : firebase.firestore.FieldValue.arrayUnion(message_data),
                    sender_seen : increment
                })

                }

            else{

                const docRefId = ref_1.docs[0].id;

                db.collection("ChatMessages").doc(docRefId).update({
                    message : firebase.firestore.FieldValue.arrayUnion(message_data),
                    receiver_seen : increment

                })
            }
            }
            $('#text_message').val("");
            $('#customFile').val("");
            $('#loadings').hide();
            $('#'+course_id+'_teacher_side_div').click();

        }
}

{#<!---------------------------------------Student Side------------------------------------------>#}

async function teacher_info(cname){

	$(".bg-light").removeClass("bg-light");
	$(cname).addClass("bg-light");

	var teacher_id = $(cname).attr("data-teacher-id");
	var course_id = $(cname).attr("data-course-id");
	var course_name = $(cname).attr("data-course-name");
	var teacher_name = $(cname).attr("data-teacher-name");
	var teacher_img = $(cname).attr("data-teacher-img");

	var student_id = $("#student_id").val()

	$('#name_teacher').text(teacher_name)
	$('#name_course').text(course_name)
	$(".avatar.avatar-online.avatar-sm").find("img").attr("src","../../../static"+teacher_img)

	$('#teacher_id').val(teacher_id)
	$('#course_id').val(course_id)
	$('#course_name').val(course_name)
	$('#teacher_img').val(teacher_img)
	$('#teacher_name').val(teacher_name)

	$('#send_button').attr('disabled', false);
	$('#text_message').attr('disabled', false);

	messages_list = ""
	$('#student_msg_div').html("");

		const ref_1 = await db.collection("ChatMessages").where('sender_id', '==', student_id).where('receiver_id', '==',teacher_id).where('course_id', '==', course_id).get();

		const ref_2 = await db.collection("ChatMessages").where('sender_id', '==', teacher_id).where('receiver_id', '==',student_id).where('course_id', '==', course_id).get();


	if (ref_1.empty){
		messages_list = ""
		db.collection("ChatMessages").where('sender_id', '==',teacher_id).where('receiver_id' , '==',  student_id).where('course_id' , '==', course_id)
		.onSnapshot(function(querySnapshot) {
				includeMetadataChanges: true;
				messages_list +='<ul class="d-flex flex-column list-unstyled" id="messages">'
				querySnapshot.forEach(function(doc) {
				doc.data()['message'].forEach(function(messages){
				console.log(messages)

				if( messages['sender_id'] == teacher_id ){


					messages_list += ' <li class="message teacher d-inline-flex" >'

					//messages_list += '<div class="message__aside">'
						//messages_list += '<a href="mini-profile.html" class="avatar avatar-sm">'
						//messages_list += '<img alt="people" class="avatar-img rounded-circle">'
						//messages_list += '</a>'
					//messages_list += '</div>'

					messages_list += '<div class="message__body card">'

					messages_list += '<div class="card-body">'
					messages_list += '<div class="d-flex align-items-center">'
						messages_list += '<div class="flex mr-3">'
						messages_list += '<a class="text-body"><strong>'+doc.data()['sender_name']+'</strong></a>'
						messages_list += '</div>'
						messages_list += '<div>'
						messages_list += '<small class="text-50">'+messages['date']+" "+messages['time'].replace(/:\d+ (\w\w)$/,' $1')+'</small>'
						messages_list += '</div>'
					messages_list += '</div>'

					messages_list +=  '<span class="text-70">'+messages['message']+'</span>'




					if(messages['file_url']){


					messages_list +=  '<a href  = '+messages['file_url']+' target="_blank" class="media align-items-center mt-2 text-decoration-0 px-3">'

					messages_list +=  '<span class="avatar mr-12pt">'

						messages_list +=  '<span class="avatar-title rounded-circle">'
						messages_list +=  '<i class="material-icons font-size-24pt">attach_file</i>'
						messages_list +=  '</span>'
					messages_list +=  '</span>'

					messages_list +=  '<span class="media-body" style="line-height: 1.5">'
						messages_list +=  '<span class="text-primary">draft.sketch</span><br>'
						messages_list +=  '<span class="text-50"></span>'
					messages_list +=  ' </span>'

					messages_list +=  '</a>'


					}


					messages_list +=  '</div>'
					messages_list +=  '</div>'
					messages_list +=  '</li>'

				}

				else if ( messages['sender_id'] == student_id ) {


					messages_list += '<li class="message d-inline-flex">'

					//messages_list += '<div class="message__aside">'
						//messages_list += '<a href="mini-profile.html" class="avatar avatar-sm">'
						//messages_list += '<img alt="people" class="avatar-img rounded-circle">'
						//messages_list += '</a>'
					//messages_list += '</div>'

					messages_list += '<div class="message__body card">'

					messages_list += '<div class="card-body">'
					messages_list += '<div class="d-flex align-items-center">'
						messages_list += '<div class="flex mr-3">'
						messages_list += '<a class="text-body"><strong>'+doc.data()['receiver_name']+'</strong></a>'

						messages_list += '</div>'
						messages_list += '<div>'
						messages_list += '<small class="text-50">'+messages['date']+" "+messages['time'].replace(/:\d+ (\w\w)$/,' $1')+'</small>'
						messages_list += '</div>'
					messages_list += '</div>'

					messages_list +=  '<span class="text-70">'+messages['message']+'</span>'


					if(messages['file_url']){


					messages_list +=  '<a href  = '+messages['file_url']+' target="_blank" class="media align-items-center mt-2 text-decoration-0 px-3">'

					messages_list +=  '<span class="avatar mr-12pt">'

						messages_list +=  '<span class="avatar-title rounded-circle">'
						messages_list +=  '<i class="material-icons font-size-24pt">attach_file</i>'
						messages_list +=  '</span>'
					messages_list +=  '</span>'

					messages_list +=  '<span class="media-body" style="line-height: 1.5">'
						messages_list +=  '<span class="text-primary">draft.sketch</span><br>'
						messages_list +=  '<span class="text-50"></span>'
					messages_list +=  ' </span>'

					messages_list +=  '</a>'

					}



					messages_list +=  '</div>'
					messages_list +=  '</div>'
					messages_list +=  '</li>'


				}


				});
			});

			messages_list +="</ul>"
			$('#student_msg_div').html("");
			$('#student_msg_div').html(messages_list);
			messages_list = ""

			var height = $("#student_msg_div").height()+200;
			$(".ps--active-y").scrollTop(height);


			});

		}

	else{

		messages_list = ""
		db.collection("ChatMessages").where('sender_id', '==',student_id).where('receiver_id' , '==',  teacher_id).where('course_id' , '==', course_id)
		.onSnapshot(function(querySnapshot) {
				includeMetadataChanges: true;
				messages_list +='<ul class="d-flex flex-column list-unstyled" id="messages">'
				querySnapshot.forEach(function(doc) {
				doc.data()['message'].forEach(function(messages){
				console.log(messages)

				if( messages['sender_id'] == teacher_id ){


					messages_list += ' <li class="message teacher d-inline-flex" >'

					//messages_list += '<div class="message__aside">'
						//messages_list += '<a href="mini-profile.html" class="avatar avatar-sm">'
						//messages_list += '<img alt="people" class="avatar-img rounded-circle">'
						//messages_list += '</a>'
					//messages_list += '</div>'

					messages_list += '<div class="message__body card">'

					messages_list += '<div class="card-body">'
					messages_list += '<div class="d-flex align-items-center">'
						messages_list += '<div class="flex mr-3">'
						messages_list += '<a class="text-body"><strong>'+doc.data()['receiver_name']+'</strong></a>'
						messages_list += '</div>'
						messages_list += '<div>'
						messages_list += '<small class="text-50">'+messages['date']+" "+messages['time'].replace(/:\d+ (\w\w)$/,' $1')+'</small>'
						messages_list += '</div>'
					messages_list += '</div>'

					messages_list +=  '<span class="text-70">'+messages['message']+'</span>'



					if(messages['file_url']){

					messages_list +=  '<a href  = '+messages['file_url']+' target="_blank" class="media align-items-center mt-2 text-decoration-0 px-3">'

					messages_list +=  '<span class="avatar mr-12pt">'

						messages_list +=  '<span class="avatar-title rounded-circle">'
						messages_list +=  '<i class="material-icons font-size-24pt">attach_file</i>'
						messages_list +=  '</span>'
					messages_list +=  '</span>'

					messages_list +=  '<span class="media-body" style="line-height: 1.5">'
						messages_list +=  '<span class="text-primary">draft.sketch</span><br>'
						messages_list +=  '<span class="text-50"></span>'
					messages_list +=  ' </span>'

					messages_list +=  '</a>'


					}


					messages_list +=  '</div>'
					messages_list +=  '</div>'
					messages_list +=  '</li>'


				}

				else if ( messages['sender_id'] == student_id ) {


					messages_list += '<li class="message d-inline-flex">'

					//messages_list += '<div class="message__aside">'
						//messages_list += '<a class="avatar avatar-sm">'
						//messages_list += '<img alt="people" class="avatar-img rounded-circle">'
						//messages_list += '</a>'
					//messages_list += '</div>'

					messages_list += '<div class="message__body card">'

					messages_list += '<div class="card-body">'
					messages_list += '<div class="d-flex align-items-center">'
						messages_list += '<div class="flex mr-3">'
						messages_list += '<a class="text-body"><strong>'+doc.data()['sender_name']+'</strong></a>'

						messages_list += '</div>'
						messages_list += '<div>'
						messages_list += '<small class="text-50">'+messages['date']+" "+messages['time'].replace(/:\d+ (\w\w)$/,' $1')+'</small>'
						messages_list += '</div>'
					messages_list += '</div>'

					messages_list +=  '<span class="text-70">'+messages['message']+'</span>'




					if(messages['file_url']){


					messages_list +=  '<a href  = '+messages['file_url']+' target="_blank" class="media align-items-center mt-2 text-decoration-0 px-3">'

					<!-- messages_list += '<a class="media align-items-center mt-2 text-decoration-0 px-3">' -->
					messages_list +=  '<span class="avatar mr-12pt">'

						messages_list +=  '<span class="avatar-title rounded-circle">'
						messages_list +=  '<i class="material-icons font-size-24pt">attach_file</i>'
						messages_list +=  '</span>'
					messages_list +=  '</span>'

					messages_list +=  '<span class="media-body" style="line-height: 1.5">'
						messages_list +=  '<span class="text-primary">draft.sketch</span><br>'
						messages_list +=  '<span class="text-50"></span>'
					messages_list +=  ' </span>'

					messages_list +=  '</a>'

					}

					messages_list +=  '</div>'
					messages_list +=  '</div>'
					messages_list +=  '</li>'


				}


				});

			});

			messages_list +="</ul>"
			$('#student_msg_div').html("");
			$('#student_msg_div').html(messages_list);
			messages_list = ""

			var height = $("#student_msg_div").height()+200;
			$(".ps--active-y").scrollTop(height);

			});

	}
}


let storageRef_student = firebase.storage().ref('files')
async function massage_student_to_teacher(){

	var file = document.getElementById("customFile_2").files[0]

	var teacher_id = $("#teacher_id").val()
	var course_id = $("#course_id").val()
	var course_name = $("#course_name").val()
	var teacher_name = $("#teacher_name").val()
	var student_id = $("#student_id").val()
	var message = $("#text_message").val()
	var student_name = "{{user_name}}"

	if (file == null){
		if (message == ""){

			$("#text_message").focus();

			}

		else{


			var sender_seen = 0
			var reciver_seen = 0

			var reciver_profile = ""
			var key = ""

			var file_type = "text"

			var today = new Date();
			var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
			var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
			var dateTime = date+' '+time;


			var message_date = new Date().toLocaleDateString('en-GB');
			var message_time = new Date().toLocaleTimeString();


			var chat_messages1 = db.collection("ChatMessages").where('sender_id', '==',teacher_id).where('receiver_id', '==',student_id).where('course_id', '==', course_id)

			var chat_messages2 = db.collection("ChatMessages").where('sender_id', '==',student_id).where('receiver_id', '==',teacher_id).where('course_id', '==', course_id)


			message_data = {

						date : message_date,

						file_type :"text",
						key : "",

						message : message,
						course_id : course_id,

						file_url : "",

						sender_id : student_id,
						time : message_time,

					}

			let chat_messages1_obj = await chat_messages1.get();

			let chat_messages2_obj = await chat_messages2.get();


			if (chat_messages1_obj.empty && chat_messages2_obj.empty ) {

					db.collection("ChatMessages").add({

					date_time : dateTime,

					message : [message_data],
					course_id : course_id,

					receiver_name : teacher_name,
					receiver_id : teacher_id,

					receiver_profile : "",
					receiver_seen : 1,

					sender_name : student_name,
					sender_id : student_id,

					sender_profile :"" ,
					sender_seen : 0,

					})
					.then(function(docRef) {
						console.log("Document written with ID: ", docRef);
					})
					.catch(function(error) {
						console.error("Error adding document: ", error);
					});

				}


			else{
				const increment = firebase.firestore.FieldValue.increment(1);
				var doc_id = "";


				const ref_1 = await db.collection("ChatMessages").where('sender_id', '==',teacher_id).where('receiver_id', '==',student_id).where('course_id', '==',course_id).get();

				const ref_2 = await db.collection("ChatMessages").where('sender_id', '==', student_id).where('receiver_id', '==', teacher_id).where('course_id', '==', course_id).get();

				if (ref_1.empty) {

				const docRefId = ref_2.docs[0].id;

				db.collection("ChatMessages").doc(docRefId).update({
					message : firebase.firestore.FieldValue.arrayUnion(message_data),
					receiver_seen : increment
				})

				}

				else{

				const docRefId = ref_1.docs[0].id;

				db.collection("ChatMessages").doc(docRefId).update({
					message : firebase.firestore.FieldValue.arrayUnion(message_data),
					sender_seen : increment
				})


				}

				}

				$('#text_message').val("");

				$('#'+course_id+'_student_side_div').click();




		}

	}

	else{

		$('#loadings').show();

		let firstFile = document.getElementById("customFile_2").files[0]

		let selected_file_name = file.name

		console.log(firstFile)

		var file_type = selected_file_name.replace(/^.*\./, '');

		console.log(file_type)

		let uploadTask;

		var path_downloadURL = ""

		if(file_type == "application/pdf"){

			$('#loadings').show();
			var metadata = {
			contentType: 'application/pdf'
			};
			uploadTask = storageRef_student.child('pdf'+Math.random()+'.pdf').put(firstFile, metadata)
			uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED,

			function progress(snapshot) {
					$('#loadings').show();
					var percentage = snapshot.bytesTransferred / snapshot.totalBytes * 100;
					console.log("percentage uploading file: " + percentage);
				},
				function error(err) {
					$('#loadings').show();
					console.log(err);
				},
				function complete() {

					uploadTask.snapshot.ref.getDownloadURL().then(function (downloadURL) {


						send_message_with_attachemt(downloadURL,message,teacher_id,student_id,course_id,teacher_name,student_name)


					})

				}

			)

			}
		else{

			$('#loadings').show();
			uploadTask = storageRef_student.child('image'+Math.random()+'.jpg').put(firstFile)
			uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED,

				function progress(snapshot) {
					$('#loadings').show();
					var percentage = snapshot.bytesTransferred / snapshot.totalBytes * 100;
					console.log("percentage uploading file: " + percentage);
				},
				function error(err) {
					$('#loadings').show();
					console.log(err);
				},
				function complete() {

					uploadTask.snapshot.ref.getDownloadURL().then(function (downloadURL) {
						console.log("Finished uploading file: " + downloadURL);

						send_message_with_attachemt(downloadURL,message,teacher_id,student_id,course_id,teacher_name,student_name)

					})



				}

			)
		}


	}

}

async function send_message_with_attachemt(downloadURL,message,teacher_id,student_id,course_id,teacher_name,student_name){

		if (message == ""){

			$("#text_message").focus();

			}

		else{

			var sender_seen = 0
			var reciver_seen = 0

			var reciver_profile = ""
			var key = ""

			var file_type = "text"

			var today = new Date();
			var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
			var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
			var dateTime = date+' '+time;


			var message_date = new Date().toLocaleDateString('en-GB');
			var message_time = new Date().toLocaleTimeString();


			var chat_messages1 = db.collection("ChatMessages").where('sender_id', '==',teacher_id).where('receiver_id', '==',student_id).where('course_id', '==', course_id)

			var chat_messages2 = db.collection("ChatMessages").where('sender_id', '==',student_id).where('receiver_id', '==',teacher_id).where('course_id', '==', course_id)


			message_data = {

						date : message_date,

						file_type :"text",
						key : "",

						message : message,
						course_id : course_id,

						file_url : downloadURL,

						sender_id : student_id,
						time : message_time,

					}

			let chat_messages1_obj = await chat_messages1.get();

			let chat_messages2_obj = await chat_messages2.get();


			if (chat_messages1_obj.empty && chat_messages2_obj.empty ) {

					db.collection("ChatMessages").add({

					date_time : dateTime,

					message : [message_data],
					course_id : course_id,

					receiver_name : teacher_name,
					receiver_id : teacher_id,

					receiver_profile : "",
					receiver_seen : 1,

					sender_name : student_name,
					sender_id : student_id,

					sender_profile :"" ,
					sender_seen : 0,

					})
					.then(function(docRef) {
						console.log("Document written with ID: ", docRef);
					})
					.catch(function(error) {
						console.error("Error adding document: ", error);
					});

				}


			else{
				const increment = firebase.firestore.FieldValue.increment(1);
				var doc_id = "";

				const ref_1 = await db.collection("ChatMessages").where('sender_id', '==',teacher_id).where('receiver_id', '==',student_id).where('course_id', '==',course_id).get();

				const ref_2 = await db.collection("ChatMessages").where('sender_id', '==', student_id).where('receiver_id', '==', teacher_id).where('course_id', '==', course_id).get();

				if (ref_1.empty) {

				const docRefId = ref_2.docs[0].id;

				db.collection("ChatMessages").doc(docRefId).update({
					message : firebase.firestore.FieldValue.arrayUnion(message_data),
					receiver_seen : increment
				})

				}

				else{

				const docRefId = ref_1.docs[0].id;

				db.collection("ChatMessages").doc(docRefId).update({
					message : firebase.firestore.FieldValue.arrayUnion(message_data),
					sender_seen : increment
				})


				}

				}

				$('#'+course_id+'_student_side_div').click();
				$('#text_message').val("");
				$('#customFile_2').val("");
				$('#loadings').hide();

				var height = $(".ps__thumb-y").height()+200;
				$(".ps__thumb-y").scrollTop(height);

			}

}

</script>
